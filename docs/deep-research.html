<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technical Deep-Dive | Zero-Copy RAG Workshop</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --azure-blue: #0078D4;
            --azure-light: #50A0E6;
            --ai-teal: #008575;
            --bg-primary: #0a0e1a;
            --bg-secondary: #111827;
            --bg-card: #1a2233;
            --text-primary: #f0f4f8;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-color: #1e293b;
            --gradient-2: linear-gradient(135deg, #0078D4 0%, #50A0E6 100%);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.8;
        }

        .topbar {
            position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
            background: rgba(10, 14, 26, 0.9); backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color); padding: 0 2rem;
        }

        .topbar-inner {
            max-width: 900px; margin: 0 auto;
            display: flex; align-items: center; justify-content: space-between; height: 56px;
        }

        .topbar a { color: var(--text-secondary); text-decoration: none; font-size: 0.875rem; font-weight: 500; transition: color 0.2s; }
        .topbar a:hover { color: var(--text-primary); }

        .topbar-brand {
            font-weight: 700; font-size: 0.9rem;
            background: var(--gradient-2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }

        .content { max-width: 900px; margin: 0 auto; padding: 7rem 2rem 4rem; }

        .page-badge {
            display: inline-flex; align-items: center; gap: 0.5rem;
            background: rgba(0, 133, 117, 0.1); border: 1px solid rgba(0, 133, 117, 0.25);
            padding: 0.35rem 1rem; border-radius: 100px;
            font-size: 0.75rem; font-weight: 600; color: #5eead4;
            margin-bottom: 1.5rem; text-transform: uppercase; letter-spacing: 0.05em;
        }

        h1 { font-size: 2.5rem; font-weight: 800; line-height: 1.2; margin-bottom: 1rem; letter-spacing: -0.03em; }
        .page-desc { font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 3rem; max-width: 700px; }

        .research-section {
            margin-bottom: 3.5rem;
            scroll-margin-top: 5rem;
        }

        .research-section h2 {
            font-size: 1.5rem; font-weight: 800; margin-bottom: 0.75rem;
            padding-bottom: 0.75rem; border-bottom: 2px solid var(--border-color);
        }

        .research-section h3 {
            font-size: 1.1rem; font-weight: 700; margin: 1.75rem 0 0.75rem; color: #5eead4;
        }

        .research-section p { color: var(--text-secondary); margin-bottom: 1rem; }
        .research-section strong { color: var(--text-primary); }

        .research-section ul, .research-section ol {
            color: var(--text-secondary); margin: 0.75rem 0 1.25rem 1.5rem;
        }

        .research-section li { margin-bottom: 0.5rem; }

        .finding-box {
            background: rgba(0, 133, 117, 0.06);
            border-left: 3px solid var(--ai-teal);
            border-radius: 0 12px 12px 0;
            padding: 1.25rem 1.5rem;
            margin: 1.25rem 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .finding-box strong { color: #5eead4; }

        .gate-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.75rem 2rem;
            margin: 1.25rem 0;
        }

        .gate-card h4 {
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--azure-light);
            margin-bottom: 0.75rem;
        }

        .gate-card ul { color: var(--text-secondary); margin-left: 1.25rem; }
        .gate-card li { margin-bottom: 0.4rem; font-size: 0.9rem; }

        hr { border: none; border-top: 1px solid var(--border-color); margin: 3rem 0; }

        code {
            font-family: 'JetBrains Mono', monospace;
            background: rgba(255,255,255,0.06); padding: 0.15rem 0.5rem;
            border-radius: 6px; font-size: 0.85em; color: #e2e8f0;
        }

        pre {
            background: var(--bg-card); border: 1px solid var(--border-color);
            border-radius: 12px; padding: 1.25rem 1.5rem; overflow-x: auto;
            margin: 1rem 0 1.5rem;
        }

        pre code { background: none; padding: 0; font-size: 0.85rem; line-height: 1.7; }

        .assessment-box {
            background: linear-gradient(135deg, rgba(0, 120, 212, 0.08), rgba(0, 133, 117, 0.08));
            border: 1px solid rgba(0, 120, 212, 0.15);
            border-radius: 16px;
            padding: 2rem 2.5rem;
            margin: 2rem 0;
        }

        .assessment-box h3 { color: var(--azure-light); margin-bottom: 1rem; font-size: 1.15rem; }
        .assessment-box ul { color: var(--text-secondary); margin-left: 1.25rem; }
        .assessment-box li { margin-bottom: 0.5rem; }

        .back-link {
            display: inline-flex; align-items: center; gap: 0.5rem;
            color: var(--azure-light); text-decoration: none; font-size: 0.9rem;
            font-weight: 500; margin-top: 2rem; transition: color 0.2s;
        }

        .back-link:hover { color: var(--text-primary); }

        footer {
            border-top: 1px solid var(--border-color); padding: 2rem;
            text-align: center; color: var(--text-muted); font-size: 0.8rem;
        }

        footer a { color: var(--azure-light); text-decoration: none; }
    </style>
</head>
<body>

<div class="topbar">
    <div class="topbar-inner">
        <a href="index.html" class="topbar-brand">&larr; Zero-Copy RAG Workshop</a>
        <a href="https://github.com/DwirefS/ANF-OneLake-AIFoundry" target="_blank">GitHub</a>
    </div>
</div>

<div class="content">
    <div class="page-badge">Research Report</div>
    <h1>Technical Deep-Dive</h1>
    <p class="page-desc">Architectural feasibility analysis validating the Azure NetApp Files &rarr; OneLake &rarr; Azure AI Search &rarr; Azure AI Foundry RAG pipeline.</p>

    <!-- Feasibility -->
    <div class="research-section">
        <h2>Architectural Feasibility</h2>
        <p>The end-to-end chain is technically feasible as a <strong>supported integration pattern</strong>, with one critical nuance: it's "zero-copy" at the storage layer (file/object duality + OneLake shortcut), but <strong>not</strong> zero-copy at the retrieval layer because Azure AI Search materializes extracted text + vectors into a search index (that's the whole point of fast hybrid/vector retrieval).</p>

        <div class="finding-box">
            <strong>Bottom line:</strong> There is documented alignment (including a dedicated Microsoft integration article for OneLake + Object REST API) that supports this workshop scenario across all four layers.
        </div>
    </div>

    <hr>

    <!-- File/Object Duality -->
    <div class="research-section">
        <h2>File/Object Duality Layer</h2>
        <h3>Object REST API on top of NFS/SMB volumes</h3>
        <p>Object REST API is explicitly described as <strong>S3-compatible</strong> and designed to "present the same data set as a file hierarchy or as objects in a bucket." It does this by mapping a specified NAS directory to an S3 bucket namespace.</p>

        <h3>Key mechanics</h3>
        <ul>
            <li><strong>Bucket = directory mapping:</strong> the system presents a specified directory hierarchy as an S3 bucket; file path boundaries use <code>/</code>.</li>
            <li><strong>Supported S3 operations:</strong> <code>GetObject</code>, <code>PutObject</code>, <code>DeleteObject</code>, list operations, and <code>HeadObject</code>.</li>
            <li><strong>Lifecycle coupling:</strong> Buckets are associated with volumes, and deleting the volume deletes the bucket permanently.</li>
            <li><strong>Certificate-driven trust model:</strong> Clients must trust the cert to access the endpoint securely.</li>
        </ul>

        <h3>Preview status</h3>
        <p>The Object REST API feature is documented as <strong>preview</strong> and requires a waitlist request for activation (not instantaneous). This matters for workshop repeatability across tenants.</p>
    </div>

    <hr>

    <!-- OneLake Virtualization -->
    <div class="research-section">
        <h2>OneLake Virtualization</h2>
        <h3>The documented integration path</h3>
        <p>Microsoft provides a specific integration article: <em>"Connect OneLake to an Azure NetApp Files volume using object REST API."</em> It describes using OneLake shortcuts to virtualize the volume into Fabric's unified data lake, and explicitly ties this to downstream indexing in Azure AI Search.</p>

        <h3>Why the Data Gateway is needed</h3>
        <p>Fabric uses the gateway not only for literal on-premises sources, but also for <strong>network-restricted endpoints</strong>. If the endpoint uses a self-signed certificate, you must trust that cert on the gateway machine.</p>

        <h3>Shortcut configuration for S3-compatible endpoints</h3>
        <ul>
            <li>You must provide a <strong>non-bucket-specific endpoint URL</strong> (service URL).</li>
            <li>The endpoint must support <strong>path-style bucket addressing</strong>.</li>
            <li>Authentication is <strong>access key + secret key only</strong> (no Entra-based OAuth for S3-compatible).</li>
        </ul>
    </div>

    <hr>

    <!-- AI Search Indexing -->
    <div class="research-section">
        <h2>Azure AI Search Indexing</h2>
        <h3>OneLake files indexer</h3>
        <p>Azure AI Search includes a <strong>OneLake files indexer</strong> (GA) designed to extract searchable content and metadata from a Fabric lakehouse. Skillsets are fully supported, including <strong>integrated vectorization</strong> (chunking + embedding steps).</p>

        <h3>Supported file types</h3>
        <p>The indexer can extract text from common formats including PDF, Office formats (DOCX/XLSX/PPTX), TXT, HTML, JSON, CSV, and others. This is directly compatible with the financial dummy data used in this workshop.</p>

        <h3>Identity and permissions</h3>
        <p>The OneLake indexer uses <strong>token authentication and Fabric workspace role assignments</strong>. There are no permission requirements on the underlying physical stores backing shortcuts. The AI Search service identity needs at least <strong>Contributor</strong> on the Fabric workspace.</p>

        <h3>Data source wiring</h3>
        <pre><code>type: "onelake"
credentials.connectionString: "ResourceId={FabricWorkspaceGuid}"
container.name: {LakehouseGuid}
container.query: "Files/anf_shortcut"  (optional folder scope)</code></pre>

        <h3>Known limitations</h3>
        <ul>
            <li>Parquet (including delta parquet) <strong>isn't supported</strong> by the OneLake files indexer.</li>
            <li>It targets the <strong>Files</strong> location in a lakehouse (not Tables).</li>
            <li>If the Fabric workspace has workspace-level private link, you must configure a shared private link from AI Search.</li>
        </ul>
    </div>

    <hr>

    <!-- Foundry Grounding -->
    <div class="research-section">
        <h2>Foundry Agent Grounding</h2>
        <h3>Direct agent-to-index grounding</h3>
        <p>Azure AI Foundry Agents can connect to an Azure AI Search index as a tool/knowledge source. The agent retrieves relevant passages and produces answers <strong>grounded in indexed content with citations</strong>.</p>

        <h3>Index schema requirements</h3>
        <ul>
            <li>Searchable/retrievable text fields (<code>Edm.String</code>)</li>
            <li>Searchable vector fields (<code>Collection(Edm.Single)</code>)</li>
            <li>At least one retrievable field containing citeable content</li>
            <li>A retrievable source URL field so citations can link back to source files</li>
        </ul>

        <h3>Hybrid retrieval</h3>
        <p>The Azure AI Search tool in Foundry agents supports <code>vector_semantic_hybrid</code> as the default query type. Hybrid retrieval is the right posture for finance documents because questions mix exact identifiers (invoice numbers, dates) and semantic intent (why a charge occurred).</p>

        <div class="finding-box">
            <strong>Networking note:</strong> For workshops, run with public endpoint (or controlled public access) for Azure AI Search and Foundry, while using private networking for the ANF endpoint + gateway. This reduces dependency risk on agent networking maturity.
        </div>
    </div>

    <hr>

    <!-- Implementation Blueprint -->
    <div class="research-section">
        <h2>Implementation Blueprint</h2>
        <p>A practical workshop flow with verification gates:</p>

        <div class="gate-card">
            <h4>Gate 1: Object endpoint is functional</h4>
            <ul>
                <li>Enable Object REST API (preview) and create a bucket mapped to the volume.</li>
                <li>Generate access key + secret key (keys shown once; rotation invalidates previous keys).</li>
                <li>Validate with an S3-compatible client (certificate required).</li>
            </ul>
        </div>

        <div class="gate-card">
            <h4>Gate 2: OneLake sees the data</h4>
            <ul>
                <li>Deploy a gateway VM with network reachability to the bucket endpoint.</li>
                <li>Create an S3-compatible shortcut in the lakehouse Files area.</li>
                <li>Confirm expected files show up in the lakehouse explorer.</li>
            </ul>
        </div>

        <div class="gate-card">
            <h4>Gate 3: Azure AI Search can index it</h4>
            <ul>
                <li>Assign Contributor permissions to the AI Search managed identity.</li>
                <li>Configure OneLake data source + indexer scoped to the shortcut path.</li>
                <li>Use integrated vectorization for chunking + embedding.</li>
            </ul>
        </div>

        <div class="gate-card">
            <h4>Gate 4: Foundry agent grounding works</h4>
            <ul>
                <li>Ensure index schema contains retrievable "content" and "source URL" fields.</li>
                <li>Connect the search index to the agent as a knowledge source.</li>
                <li>Demo hybrid retrieval with finance-relevant questions.</li>
            </ul>
        </div>
    </div>

    <hr>

    <!-- Net Assessment -->
    <div class="research-section">
        <h2>Net Assessment</h2>
        <div class="assessment-box">
            <h3>A compelling "data gravity" pattern</h3>
            <ul>
                <li><strong>Object REST API</strong> delivers file/object duality on the same dataset.</li>
                <li><strong>OneLake shortcuts</strong> virtualize external object-accessible data into a unified data estate, with gateway support for restricted networks.</li>
                <li><strong>Azure AI Search</strong> provides the indexing + vectorization substrate for RAG and agentic retrieval from OneLake-backed files.</li>
                <li><strong>Foundry agents</strong> can consume the search index as a grounding tool, with schema requirements that are straightforward to bake into a repeatable lab.</li>
            </ul>
        </div>
    </div>

    <a href="index.html" class="back-link">&larr; Back to Workshop Home</a>
</div>

<footer>
    <p>Licensed under <a href="https://github.com/DwirefS/ANF-OneLake-AIFoundry/blob/main/LICENSE">Apache License 2.0</a> &middot; <a href="https://github.com/DwirefS/ANF-OneLake-AIFoundry">GitHub Repository</a></p>
</footer>

</body>
</html>
